/*
  Â© 2021 Sanha, all rights reserved.
*/

function complex(){let e=complex._typer(arguments[0])+complex._typer(arguments[1]);switch(arguments.length){case 1:if("nx"==e)this.re=arguments[0],this.im=0;else{if("cx"!=e)throw new Error;this.re=arguments[0].re,this.im=arguments[0].im}break;case 2:if("nn"==e)this.re=arguments[0],this.im=arguments[1];else if("cn"==e){if(arguments[0].im)throw new Error;this.re=arguments[0].re,this.im=arguments[1]}else if("nc"==e){if(arguments[1].im)throw new Error;this.re=arguments[0],this.im=arguments[1].re}else{if("cc"!=e)throw new Error;if(arguments[0].im||arguments[1].im)throw new Error;this.re=arguments[0].re,this.im=arguments[1].re}break;case 3:if("polar"!=arguments[2])throw new Error;if("nn"==e)this.re=arguments[0]*Math.cos(arguments[1]),this.im=arguments[0]*Math.sin(arguments[1]);else if("cn"==e){if(arguments[0].im)throw new Error;this.re=arguments[0].re*Math.cos(arguments[1]),this.im=arguments[0]*reMath.sin(arguments[1])}else if("nc"==e){if(arguments[1].im)throw new Error;this.re=arguments[0]*Math.cos(arguments[1].re),this.im=arguments[0]*Math.sin(arguments[1].re)}else{if("cc"!=e)throw new Error;if(arguments[0].im||arguments[1].im)throw new Error;this.re=arguments[0].re*Math.cos(arguments[1].re),this.im=arguments[0].re*Math.sin(arguments[1].re)}}}function cxmath(){}complex._typer=(e=>"number"!=typeof e&&"string"!=typeof e||Number.isNaN(e)?e instanceof complex?"c":"x":"n"),Object.defineProperty(complex.prototype,"abs",{get(){return Math.hypot(this.re,this.im)},set(e){let r=Number(this.abs);this.re=this.re*e/r,this.im=this.im*e/r}}),Object.defineProperty(complex.prototype,"arg",{get(){return Math.atan2(this.im,this.re)},set(e){let r=Number(this.abs);this.re=Math.cos(e)*r,this.im=Math.sin(e)*r}}),complex.prototype.toString=function(){return this.re+(Math.sign(this.im)+1?"+":"")+this.im+"i"},complex.prototype.add=function(e){let r=complex._typer(e);if("n"==r)return new complex(this.re+e,this.im);if("c"==r)return new complex(this.re+e.re,this.im+e.im);throw new Error},complex.prototype.sub=function(e){let r=complex._typer(e);if("n"==r)return new complex(this.re-e,this.im);if("c"==r)return new complex(this.re-e.re,this.im-e.im);throw new Error},complex.prototype.mul=function(e){let r=complex._typer(e);if("n"==r)return new complex(this.re*e,this.im*e);if("c"==r)return new complex(this.re*e.re-this.im*e.im,this.re*e.im+this.im*e.re);throw new Error},complex.prototype.div=function(e){let r=complex._typer(e);if("n"==r)return new complex(this.re/e,this.im/e);if("c"==r){let r=Math.pow(e.abs,2);return new complex((this.re*e.re+this.im*e.im)/r,(-this.re*e.im+this.im*e.re)/r)}throw new Error},complex.prototype.inv=function(e){let r=complex._typer(e);if("n"==r){if(Number.isInteger(e)){let r=new complex(1),t=new complex(this.re,this.im);if(e>=0)for(let n=0;n<e;n++)r=r.mul(t);else for(let n=0;n>e;n--)r=r.div(t);return r}return new complex(Math.pow(this.abs,e),this.arg*e,"polar")}if("c"==r){return new complex(Math.pow(this.abs,e.re)*Math.exp(-e.im*this.arg),e.re*this.arg+e.im*Math.log(this.abs),"polar")}throw new Error},cxmath.conj=function(e){if("x"==complex._typer(e))throw new Error;let r=new complex(e);return r.sub(new complex(0,2*r.im))},cxmath.opp=function(e){if("x"==complex._typer(e))throw new Error;let r=new complex(e);return r.sub(new complex(2*r.re,2*r.im))},cxmath.sqrt=function(e){if("x"==complex._typer(e))throw new Error;return new complex(e).inv(.5)},cxmath.cbrt=function(e){if("x"==complex._typer(e))throw new Error;return new complex(e).inv(1/3)},cxmath.exp=function(e){if("x"==complex._typer(e))throw new Error;return new complex(Math.E).inv(e)},cxmath.log=function(e,r){if(r){if((complex._typer(e)+complex._typer(r)).includes("x"))throw new Error;let t=new complex(e),n=new complex(r);return new complex(Math.log(t.abs),t.arg).div(new complex(Math.log(n.abs),n.arg))}{let r=new complex(e);return new complex(Math.log(r.abs),r.arg)}},cxmath.sin=function(e){if("x"==complex._typer(e))throw new Error;let r=new complex(e),t=new complex(0,1);return cxmath.exp(r.mul(t)).sub(cxmath.exp(cxmath.opp(r).mul(t))).div(t.mul(2))},cxmath.cos=function(e){if(complex._typer(e).includes("x"))throw new Error;let r=new complex(e),t=new complex(0,1);return cxmath.exp(r.mul(t)).add(cxmath.exp(cxmath.opp(r).mul(t))).div(2)},cxmath.tan=function(e){if(complex._typer(e).includes("x"))throw new Error;return cxmath.sin(e).div(cxmath.cos(e))},cxmath.asin=function(e){if(complex._typer(e).includes("x"))throw new Error;let r=new complex(e),t=new complex(0,1);return cxmath.ln(t.mul(r).add(cxmath.sqrt(cxmath.opp(r.inv(2).sub(1))))).mul(cxmath.conj(t))},cxmath.acos=function(e){if(complex._typer(e).includes("x"))throw new Error;return new complex(Math.PI).sub(cxmath.asin(e)).sub(2)},cxmath.atan=function(e){if(complex._typer(e).includes("x"))throw new Error;let r=new complex(e),t=new complex(0,1);return t.div(2).mul(cxmath.ln(t.add(r).div(t.sub(r))))},cxmath.atan2=function(e,r){if((complex._typer(e)+complex._typer(r)).includes("x"))throw new Error;return cxmath.atan(new complex(e).div(new complex(r)))},cxmath.sinh=function(e){if(complex._typer(e).includes("x"))throw new Error;return cxmath.exp(e).sub(cxmath.exp(cxmath.opp(e))).div(2)},cxmath.cosh=function(e){if(complex._typer(e).includes("x"))throw new Error;return cxmath.exp(e).add(cxmath.exp(cxmath.opp(e))).div(2)},cxmath.tanh=function(e){if(complex._typer(e).includes("x"))throw new Error;return cxmath.sinh(e).div(cxmath.cosh(e))},cxmath.asinh=function(e){if(complex._typer(e).includes("x"))throw new Error;let r=new complex(e);return cxmath.ln(r.add(cxmath.sqrt(r.inv(2).add(1))))},cxmath.acosh=function(e){if(complex._typer(e).includes("x"))throw new Error;let r=new complex(e);return cxmath.ln(r.add(cxmath.sqrt(r.inv(2).sub(1))))},cxmath.atanh=function(e){if(complex._typer(e).includes("x"))throw new Error;let r=new complex(1,0);return cxmath.ln(r.add(e).div(r.sub(e))).div(2)},cxmath.csgn=function(e){let r=complex._typer(e);if("n"==r)return new complex(Math.sign(e));if("c"==r)return e.re?new complex(Math.sign(e.re)):new complex(Math.sign(e.im));throw new Error},cxmath.am=function(){let e=Array.from(arguments);if(e.map(e=>complex._typer(e)).includes("x"))throw new Error;return e.map(e=>new complex(e)).reduce((e,r)=>e.add(r)).div(e.length)},cxmath.gm=function(){let e=Array.from(arguments);if(e.map(e=>complex._typer(e)).includes("x"))throw new Error;return e.map(e=>new complex(e)).reduce((e,r)=>e.mul(r)).inv(1/e.length)},cxmath.dist=function(e,r){if((complex._typer(e)+complex._typer(r)).includes("x"))throw new Error;let t=new complex(e),n=new complex(r);return new complex(Math.hypot(t.re-n.re,t.im-n.im))},cxmath.random=function(){return new complex(Math.random(),Math.random())},module.exports={Complex:complex,Cxmath:cxmath};
